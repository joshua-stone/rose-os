# Generated by Anaconda 41.31
# Generated by pykickstart v3.58
#version=DEVEL

%pre --erroronfail
set -oeux pipefail
source /run/install/repo/kickstart/kickstart-env-vars

readonly IMAGE_NAME="${REGISTRY}/${ORG}-${FLAVOR}:${TAG}"
readonly IMAGE_DIR="${REGISTRY}/${ORG}-${FLAVOR}-${TAG}"
cat << EOL > /tmp/ks-anaconda-ostreecontainer.ks
ostreecontainer --stateroot="${ORG}" --transport="oci" --url="/mnt/install/repo/kickstart/oci/${IMAGE_DIR}/"
EOL

cat << EOL > /tmp/ks-post-install-ostree-setup.sh
ostree remote add --verbose --force "${ORG}" "${IMAGE_NAME}"
sed -i 's@container-image-reference.*@container-image-reference=ostree-image-signed:docker://${IMAGE_NAME}@g' /ostree/deploy/${ORG}/deploy/*.origin
EOL
%end

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# OSTree container setup
%include /tmp/ks-anaconda-ostreecontainer.ks

# Use graphical install
graphical

# System timezone
timezone America/New_York

#Root password
rootpw --lock

services --disabled flatpak-add-fedora-repos

%post --erroronfail
set -oeux pipefail
%include /tmp/ks-post-install-ostree-setup.sh

cat << EOL > /tmp/flathub.flatpakrepo
%include /run/install/repo/kickstart/flatpak/remotes/flathub.flatpakrepo
EOL

flatpak remote-add --verbose --if-not-exists flathub /tmp/flathub.flatpakrepo
%end
